/* =========================================================
   ABON OS — ENTERPRISE LAYOUT SHELL (FINAL VERSION)
   Ultra-stable stacking, popup-safe, mobile-safe
========================================================= */

/* =========================================================
   LAYOUT TOKENS ONLY
========================================================= */
:root {
  --sidebar-width: 240px;
  --sidebar-width-collapsed: 64px;
  --sidebar-current-width: var(--sidebar-width);

  --topbar-height: 64px;
  --subnav-height: 48px;

  --content-gutter: 20px;
  --content-max: 1420px;

  --color-bg: var(--bg-0);
  --color-bg-sidebar: var(--bg-1);
  --color-bg-card: var(--bg-1);
  --color-text: var(--text-0);
  --color-border: var(--border-1);
  --color-accent: var(--accent-0);

  --shadow: 0 8px 24px rgba(0,0,0,0.35);
}

/* Collapsed */
.layout-shell.collapsed {
  --sidebar-current-width: var(--sidebar-width-collapsed);
}

/* =========================================================
   ROOT LAYOUT SHELL
   IMPORTANT: REMOVE z-index to avoid stacking context
========================================================= */
.layout-shell {
  position: relative;
  width: 100%;
  min-height: 100vh;

  /* ❌ removed z-index: 0 */
  /* no stacking context */
  
  background: var(--color-bg);
  display: flex;
}

/* =========================================================
   SIDEBAR (fixed)
========================================================= */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;

  width: var(--sidebar-current-width);
  height: 100vh;

  background: var(--color-bg-sidebar);
  border-right: 1px solid var(--color-border);

  overflow: hidden;
  transition: width .25s ease;

  z-index: 800;
}

/* =========================================================
   TOP BAR (fixed)
========================================================= */
.topbar {
  position: fixed;
  top: 0;
  left: var(--sidebar-current-width);
  right: 0;

  height: var(--topbar-height);

  display: flex;
  align-items: center;
  padding: 0 24px;

  background: rgba(28,28,30,0.50);
  backdrop-filter: blur(16px);

  border-bottom: 1px solid var(--color-border);
  transition: left .25s ease;

  z-index: 900; /* correct */
}

/* Ensure topbar ALWAYS clears sidebar */
.layout-shell.collapsed .topbar {
  left: var(--sidebar-width-collapsed);
}

/* =========================================================
   SUBNAV
========================================================= */
.subnav {
  position: fixed;
  top: var(--topbar-height);
  left: var(--sidebar-current-width);
  right: 0;

  height: var(--subnav-height);

  display: flex;
  align-items: center;
  padding: 0 24px;

  background: rgba(28,28,30,0.35);
  backdrop-filter: blur(12px);

  border-bottom: 1px solid var(--color-border);
  transition: left .25s ease;

  z-index: 850;
}

.layout-shell.collapsed .subnav {
  left: var(--sidebar-width-collapsed);
}

/* =========================================================
   CONTENT AREA (scrollable)
   IMPORTANT: REMOVE z-index so modal can pass over it
========================================================= */
.content-area {
  position: relative;
  margin-left: var(--sidebar-current-width);

  padding-top: calc(var(--topbar-height) + var(--subnav-height) + 24px);
  padding-left: var(--content-gutter);
  padding-right: var(--content-gutter);

  width: calc(100% - var(--sidebar-current-width));
  min-height: 100vh;

  overflow-y: auto;
  overflow-x: hidden;

  transition: margin-left .25s ease;

  /* ❌ REMOVE z-index: 0 
     if this exists, popups can NEVER appear above */
}

/* Collapsed mode */
.layout-shell.collapsed .content-area {
  margin-left: var(--sidebar-width-collapsed);
  width: calc(100% - var(--sidebar-width-collapsed));
}

/* =========================================================
   MOBILE
========================================================= */
@media (max-width: 720px) {
  .sidebar {
    transform: translateX(-100%);
    transition: transform .25s ease;
  }

  .sidebar.open {
    transform: translateX(0);
  }

  .topbar,
  .subnav {
    left: 0 !important;
  }

  .content-area {
    margin-left: 0 !important;
    width: 100% !important;
    padding-top: calc(var(--topbar-height) + var(--subnav-height) + 20px);
  }
}